# ç»„åˆæ¨¡å‹

ä¸Šç¯‡æˆ‘ä»¬ä½¿ç”¨å‘½ä»¤æ¨¡å¼ï¼Œå¸®åŠ©ç”Ÿäº§å‘˜å°å•ƒğŸ’‚æ›´å¥½çš„ç”Ÿæ´»ã€‚

å•ƒå¾—é¸¡çš„ç”Ÿäº§çº¿é€šè¿‡å¼•å…¥è‡ªåŠ¨ç”Ÿäº§çº¿ï¼Œäº§é‡æ¿€å¢ï¼›ä½†é”€å”®çº¿å¹¶æ²¡åŠæ³•é€šè¿‡ç§‘æŠ€çˆ†ç‚¸å®ç°é”€å”®çš„æ¿€å¢ã€‚

æ‰€ä»¥å•ƒå¾—é¸¡å†³å®šï¼ŒæŠŠéƒ¨åˆ†å•†å“é€šè¿‡è®©åˆ©çš„æ–¹å¼ç»™åˆ°ç»é”€å•†é”€å”®ï¼›èµ°è–„åˆ©å¤šé”€çš„æ–¹å¼æ¶ˆåŒ–äº§èƒ½ã€‚

å¤§ç»é”€å•†ï¼Œä¹Ÿé€šè¿‡è®©åˆ©çš„æ–¹å¼å°†å•†å“ç»™åˆ°å°ç»é”€å•†;æœ€ç»ˆç»™åˆ°æ¶ˆè´¹è€…æ‰‹ä¸­ã€‚

ä»£ç ä¸Šæ€ä¹ˆå®ç°ï¼Ÿ



## åœºæ™¯åˆ†æ

è¿™é‡Œå¯ä»¥çœ‹åˆ°

> å•ƒå¾—é¸¡å‚å®¶ï¼Œå¯¹åº”æœ‰Nä¸ªå¤§ç»é”€å•† å¤§ç»é”€å•†ï¼Œå¯¹åº”æœ‰Nä¸ªå°ç»é”€å•† ... å°ç»é”€å•†ï¼Œå¯¹åº”Nä¸ªé›¶å”®å•† é›¶å”®å•†ï¼Œå¯¹åº”Nä¸ªé¡¾å®¢

å¯ä»¥å‘ç°åœ¨æ•´ä¸ªé”€å”®é“¾æ˜¯ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼š

å‚å®¶ -> nå¤§ç»é”€å•† -> ... -> né›¶å”®å•† -> né¡¾å®¢

å‚å®¶æ‰®æ¼”äº†ã€æä¾›å•†ã€‘ï¼Œé¡¾å®¢æ‰®æ¼”äº†ã€æ¶ˆè´¹è€…ã€‘; å…¶ä»–éƒ½åŒæ—¶æ‰®æ¼”äº†ä¸¤ä¸ªè§’è‰²ï¼šã€æ¶ˆè´¹è€…ã€‘ã€ã€æä¾›å•†ã€‘ï¼›

åœ¨é”€å”®çš„æ•´ä¸ªé“¾æ¡ä¸­ï¼Œæ¯ä¸€å±‚éƒ½åªå…³æ³¨è‡ªå·±ä¸Šä¸‹æ¸¸ï¼Œå¯¹å…¶ä»–çš„å¹¶ä¸å¤šè¿‡é—®ã€‚

å¦‚æœå°†ã€æ¶ˆè´¹è€…ã€‘ã€ã€æä¾›å•†ã€‘æŠ½æä¸ºæ¥å£å°±æ˜¯ä¸€ä¸ªè¡Œä¸º buy; åŒæ—¶å®ç°ç±»åšçˆ¶å­ç»“æ„åµŒå¥—ï¼Œå³å®Œæˆæ•´ä¸ªé“¾æ¡çš„è¡¨è¿°ã€‚



## å®ç°æ€è·¯

![ç»„åˆæ¨¡å¼](17ç»„åˆæ¨¡å‹.assets/ç»„åˆæ¨¡å¼.drawio.svg)

### æ¥å£Component

```cpp
class Component
{
public:
	explicit Component(string key) : m_sKey(key) , m_pParent(nullptr) {}
	virtual ~Component() {}
public:
	virtual void add(string key, Component* component) {}
	virtual void remove(string key) {}
	virtual Component* getParent(){ return m_pParent; }
	virtual void setParent(Component* component) { m_pParent = component; }
	virtual Component* getChild() { return nullptr; }
	virtual void refresh() {}
public:
	virtual int buy(int num) { return 0; }
	virtual int needNum() { return 0;  }

protected:
	string m_sKey;
	Component* m_pParent;
};
```



### å¶å­ Leaf

```cpp
class Leaf : public Component
{
public:
	explicit Leaf(string key) : Component(key) {}
public:
	int buy(int num)
	{
		cout << m_sKey << "è´­ä¹°äº†" << num << "æ ¹é›ªç³•ï¼" << endl;
		return 0;
	}

	int needNum()
	{
		return 1;
	}
};
```



### ä¸€èˆ¬èŠ‚ç‚¹ï¼šComposite

```cpp
class Composite : public Component
{
public:
	Composite(string key) 
		: Component(key)
		, m_nNeedNum(0)
	{
	}

	virtual ~Composite()
	{
		m_oChildren.clear();
	}

public:
	void add(Component* component)
	{
		m_oChildren.push_back(component);
		component->setParent(this);
		refresh();
	}

	void remove(int index)
	{
		m_oChildren.erase(m_oChildren.begin() + index);
		refresh();
	}

	Component* getChild(int index)
	{ 
		return m_oChildren[index];
	}

	void refresh() 
	{
		m_nNeedNum = 0;
		for each (auto var in m_oChildren)
		{
			m_nNeedNum += var->needNum();
		}
		if (nullptr != getParent())
		{
			getParent()->refresh();
		}
	}
public:
	int buy(int num)
	{
		cout << m_sKey << "è¿›è´§" << num << "æ ¹é›ªç³•ï¼" << endl;
		for each (auto var in m_oChildren)
		{
			num -= var->needNum();
			var->buy(var->needNum()) ;
		}
		return num;
	}

	int needNum()
	{
		return m_nNeedNum;
	}

private:
	int m_nNeedNum;
	vector<Component*> m_oChildren;
};
```



### mainå‡½æ•°

```cpp
int main(int argc, char* argv[])
{
	Composite oComposite("å‚å®¶");
	Composite oComposite1("ä»£ç†å•†");
	Composite oComposite2("é›¶å”®å•†1");
	Composite oComposite3("é›¶å”®å•†2");
	Leaf oLeaf1("é¡¾å®¢å°ç‹");
	Leaf oLeaf2("é¡¾å®¢å°æ");

	oComposite.add(&oComposite1);
	oComposite1.add(&oComposite2);
	oComposite1.add(&oComposite3);
	oComposite2.add(&oLeaf1);
	oComposite3.add(&oLeaf2);

	oComposite.buy(2);
	return 0;
}
```



è¿è¡Œç»“æœï¼š ![ç»“æœ](17ç»„åˆæ¨¡å‹.assets/202207281945959.png)



## æ„Ÿæ‚Ÿ

ç»„åˆæ¨¡å¼åˆå« â€œéƒ¨åˆ†æ•´ä½“æ¨¡å¼â€ï¼Œè¿™ä¸ªåå­—å¯ä»¥æ›´å¥½çš„è¡¨è¾¾è¿™ä¸ªæ¨¡å¼æƒ³è¦è§£å†³çš„é—®é¢˜ã€‚

åŠï¼šäº‹ç‰©çš„ éƒ¨åˆ†å’Œæ•´ä½“å…·æœ‰é«˜åº¦ç›¸ä¼¼æ€§ã€‚

åœ¨ç»„åˆæ¨¡å¼ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„ç±»å®šä¹‰ä¸­ï¼Œéƒ½å¯ä»¥ç»§ç»­åŒ…å«ä¸€ç»„å’Œè‡ªå·±ç›¸åŒçš„å¯¹è±¡ï¼›

å¶å­èŠ‚ç‚¹çš„å®šä¹‰ä¸æ˜¯å¿…é¡»ï¼Œä½†å¶å­èŠ‚ç‚¹ä¸€èˆ¬æ˜¯å¿…ç„¶å­˜åœ¨çš„ï¼ˆæ•°æ®æ˜¯æœ‰é™çš„ï¼‰ã€‚

### å…³äºæ¥å£å®šä¹‰

æœ¬æ¡ˆä¾‹ä¸­æ¥å£çš„å®šä¹‰é™¤äº†å”¯ä¸€çš„ä¸šåŠ¡æ¥å£ä¸º buyå¤–ï¼Œè¿˜åŒ…å«å¯¹èŠ‚ç‚¹çš„æ“ä½œï¼šaddï¼Œremoveï¼ŒgetChild, getParentç­‰éä¸šåŠ¡åŠŸèƒ½å®šä¹‰ï¼›

è¿™æ„å‘³ç€ï¼Œå¯ä»¥å®¢æˆ·ç«¯å¯ä»¥ç»Ÿä¸€çš„æ“ä½œå¶å­èŠ‚ç‚¹å’Œæ ¹èŠ‚ç‚¹ï¼Œè¿™ç§æ–¹å¼ä¹Ÿå«**é€æ˜ç»„åˆæ¨¡å¼**ï¼›

è¿™ç§æ–¹å¼ä¹Ÿæ„å‘³ç€ä¸€ä¸ªé—®é¢˜ï¼Œå®¢æˆ·ç«¯åœ¨å¶å­èŠ‚ç‚¹è°ƒç”¨ add ï¼Œremoveç­‰æ“ä½œå¯¼è‡´å¤±è´¥ï¼›ä½†å®¢æˆ·ç«¯ä¸çŸ¥é“ï¼Œå…·æœ‰ä¸€å®šçš„å®‰å…¨æ€§é—®é¢˜ã€‚

äºæ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåˆå‘æ˜å‡ºä¸€ä¸ª**å®‰å…¨ç»„åˆæ¨¡å¼**

![ç»„åˆæ¨¡å¼-å®‰å…¨](17ç»„åˆæ¨¡å‹.assets/ç»„åˆæ¨¡å¼-å®‰å…¨.drawio.svg)

è¿™é‡Œæ¥å£å°†ä¸å­˜åœ¨add ï¼Œremoveç­‰æ“ä½œï¼Œå®¢æˆ·ç«¯éœ€è¦æ˜ç¡®çŸ¥é“å½“å‰èŠ‚ç‚¹çš„ç±»å‹æ‰èƒ½åšå¯¹åº”æ“ä½œã€‚



## ä»£ç ä½ç½®

https://github.com/su-dd/learning/tree/main/src/design_pattern/Component